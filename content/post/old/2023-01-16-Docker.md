+++
title = "Docker"
description = ""
date = 2023-01-16T14:25:02+08:00
featured = false
comment = true
toc = true
reward = true
categories = [
  ""
]
tags = [
  "Docker"
]
series = []
images = []
+++

è¦æƒ³ä½¿ç”¨dockerï¼Œéœ€è¦æ­£ç¡®çš„äº†è§£ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œæ¯”å¦‚ image æ˜¯å•¥ã€å®¹å™¨æ˜¯å•¥ã€ docker hub æ˜¯å•¥ ã€ ä¸ºä»€ä¹ˆpullç­‰ç­‰ï¼Œæˆ‘è¿™é‡Œå…ˆç»™å‡ºä¸€äº›ç®€å•çš„è§£é‡Šï¼Œä½†æ˜¯è¯¦ç»†å¯èƒ½è¿˜æ˜¯å¾—äº²èº«ä½“éªŒæ‰èƒ½ç†è§£ï¼š
- image é•œåƒï¼Œå¯ä»¥pullé•œåƒç„¶åè¿è¡Œå®ƒ
- å®¹å™¨ ï¼Œè¿è¡Œä¸­çš„ image æˆ‘ä»¬å«å®ƒ å®¹å™¨ï¼Œç±»ä¼¼è™šæ‹Ÿæœºï¼Œä½†æ˜¯æ›´è½»é‡çº§ã€‚
- docker hub ï¼Œ dockerçš„å®˜æ–¹ image ä»“åº“ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½åˆ°å¾ˆå¤šåˆ«äººåšçš„ image æ¥ä½¿ç”¨

## æ€»ç»“/å¸¸ç”¨å‘½ä»¤

å®Œæˆäº†ä»¥ä¸Šçš„tutorialï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±å¯¹dockerå·²ç»æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨å®ƒäº†ã€‚

æŸ¥çœ‹ä¸€ä¸‹æœ¬åœ°ç°æœ‰çš„ image

```sh
docker image ls
```

å¯åŠ¨ getting-started é•œåƒï¼Œåå°æ¨¡å¼ï¼Œæ˜ å°„ 3000 ç«¯å£ï¼Œ

```sh
docker run -dp 3000:3000 getting-started
```

ğŸŒŸ æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨

```sh
docker ps
docker ps -a #åŒ…æ‹¬æœªè¿è¡Œçš„
docker ps -s #æ˜¾ç¤ºå¤§å°
docker ps -q #ä»…æ˜¾ç¤ºå®¹å™¨id
```

ğŸŒŸ è¿›å…¥å®¹å™¨ï¼ˆé€‰æ‹©bash ã€ sh ã€ zshã€cmd ï¼Œçœ‹å®¹å™¨å†…éƒ¨åŸºäºä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼‰

```
docker exec -it <container-ID> sh
```

- `-i` äº¤äº’æ¨¡å¼
- `-t` ç»ˆç«¯

å¯åŠ¨å®¹å™¨

```sh
docker start <container-ID>
```

åœæ­¢å®¹å™¨

```sh
docker stop <container-ID>
docker kill <container-ID> #å¼ºè¡Œé€€å‡º
```

åˆ é™¤å®¹å™¨(åˆ é™¤å‰éœ€è¦å…ˆåœæ­¢å®¹å™¨)

```sh
docker rm <container-ID>
docker rm -f <container-ID> #å¼ºåˆ¶åˆ é™¤
```

æŸ¥çœ‹ç«¯å£æ˜ å°„ï¼ˆæ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼‰

```sh
docker port <container-ID>
```

æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼ˆcpuã€å†…å­˜å®æ—¶ä½¿ç”¨æƒ…å†µç­‰ï¼‰

```
docker container stats
```


## install

### windows
1. å®‰è£…å¥½wslï¼ˆåœ¨winå•†åº—æœubuntuï¼‰
2. ä¸‹è½½docker ï¼š  [docker](https://www.docker.com)
3. å¡åœ¨startingçš„è§£å†³åŠæ³•ï¼š

ä½¿ç”¨ç®¡ç†å‘˜æƒé™çš„ powershellï¼š

```
net stop com.docker.service
net start com.docker.service

wsl --unregister docker-desktop
wsl --unregister docker-desktop-data
```

## 1-æŠŠåº”ç”¨ç¨‹åºå®¹å™¨åŒ–

https://docs.docker.com/get-started/02_our_app/

Docker Hub æ˜¯ä¸€ä¸ªå®˜æ–¹ç½‘ç«™ï¼Œä¸Šé¢å¯ä»¥ä¸‹è½½å¾ˆå¤š imagesã€‚

è¿è¡Œä¸­ image çš„å«åš container ï¼ˆå®¹å™¨ï¼‰ï¼Œä»–ä»¬è¿è¡Œçš„æ—¶å€™éƒ½æ˜¯å’Œä½ çš„ç”µè„‘éš”ç¦»çš„ï¼Œå°±å¥½åƒå¼€äº†ä¸€å †å°å·çš„è™šæ‹Ÿæœºã€‚

è€Œå®é™…ä¸Šï¼Œåœ¨docker hub ä¸‹è½½çš„ images æ˜¯åˆ«äººæ‰“åŒ…å¥½çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ dvwa ï¼ˆæ¸—é€é¶åœºï¼‰ã€oracle 11g ç­‰ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ•™ç¨‹é‡Œï¼Œæˆ‘ä»¬è¦è‡ªå·±æŠŠæœ¬åœ°çš„ç¤ºä¾‹ Node.js ç¨‹åºå˜æˆä¸€ä¸ªå®¹å™¨ã€‚

## ä¸‹è½½ç¨‹åº

```
git clone https://github.com/docker/getting-started.git
```

## Dockerfile

æœ¬æ•™ç¨‹æ˜¯ Node js çš„æ„å»ºï¼Œå…¶ä»–çš„ä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹æ•™ç¨‹å†™ `Dockerfile` , æ¯”å¦‚ `python`
https://docs.docker.com/language/python/build-images/

æˆ‘ä»¬å…³æ³¨ `getting-started/app` è¿™ä¸ªç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `Dockerfile` æ–‡ä»¶ï¼Œå¹¶ç¼–è¾‘å†…å®¹å¦‚ä¸‹ï¼š

```dockerfile
## syntax=docker/dockerfile:1
FROM node:18-alpine
WORKDIR /app
COPY . .
RUN yarn install --production
CMD ["node", "src/index.js"]
EXPOSE 3000
```

> æŒ‡ç¤ºæ„å»ºå™¨ä»`node:18-alpine` `image` å¼€å§‹ã€‚ä½†æ˜¯ï¼Œç”±äºæœºå™¨ä¸Šæ²¡æœ‰å®ƒï¼ŒDocker éœ€è¦ä¸‹è½½ imageã€‚
> `Docker` ä¸‹è½½ `image` åï¼Œæ ¹æ® `Dockerfile` ä¸­çš„è¯´æ˜æŠŠæ•´ä¸ªç›®å½•çš„æ–‡ä»¶å¤åˆ¶åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶ä½¿ç”¨`yarn`å®‰è£…åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹ã€‚`CMD` æŒ‡ä»¤æŒ‡å®šä»æ­¤æ˜ åƒå¯åŠ¨å®¹å™¨æ—¶è¦è¿è¡Œçš„é»˜è®¤å‘½ä»¤ã€‚

- `FROM` å®šä¹‰åŸºç¡€ image ï¼Œ`Dockerfile` å¿…é¡»ä»¥ `FROM` å¼€å¤´ã€‚
- `WORKDIR` æ˜¯ä¸ºåç»­å‘½ä»¤æä¾›æ‰§è¡Œç›®å½•ï¼Œå¦‚ `COPY`ã€ `RUN`ã€ `CMD` ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤å·¥ä½œç›®å½•æ˜¯ `/`ã€‚
- `COPY` æŒ‡ä»¤ä» `<src>` å¤åˆ¶æ–°æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è·¯å¾„ `<dest>` çš„å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¿™é‡Œ `src` å’Œ `dest` éƒ½æ˜¯ `.` ã€‚
- `RUN` æ‰§è¡Œ shell å‘½ä»¤ï¼Œ`FROM` æ˜¯ `windows` çš„è¯å°±æ˜¯æ‰§è¡Œ `cmd`ã€‚
- `CMD ["executable","param1","param2"]` 
- `EXPOSE` æŠŠå®¹å™¨å†…éƒ¨çš„ç«¯å£å¼€æ”¾åˆ°å¤–éƒ¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š tcp ã€ udp ï¼Œ ä½†æ— è®º `EXPOSE` è®¾ç½®å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨`-p` æ ‡å¿—è¦†ç›–å®ƒä»¬ï¼Œå¦‚  `docker run -p 80:80`

```
EXPOSE 80/tcp
EXPOSE 80/udp
```

## æ„å»ºå®¹å™¨ image

è¿˜æ˜¯å›åˆ° `getting-started/app` ç›®å½•ï¼Œæ‰§è¡Œï¼š

```sh
docker build -t getting-started .
```
- `-t getting-started` ç»™é•œåƒè®¾ç½®ä¸€ä¸ªæ˜µç§°ã€‚
- `docker build . ` åœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ `Dockerfile` ã€‚

## å¯åŠ¨å®¹å™¨

```sh
docker run -dp 3000:3000 getting-started
```

- `-d` æ ‡å¿—åœ¨â€œåˆ†ç¦»â€æ¨¡å¼ä¸‹ï¼ˆåœ¨åå°ï¼‰è¿è¡Œæ–°å®¹å™¨
- `-p` æ ‡å¿—åœ¨ä¸»æœºçš„ç«¯å£`3000`å’Œå®¹å™¨çš„ç«¯å£`3000`ä¹‹é—´åˆ›å»ºæ˜ å°„

æ‰“å¼€æ‚¨çš„ç½‘é¡µæµè§ˆå™¨åˆ°[http://localhost:3000](http://localhost:3000/)ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‚¨çš„åº”ç”¨ã€‚

## ä¿®æ”¹å’Œæ›´æ–°image

ä¿®æ”¹å’Œæ›´æ–°è¿™é‡Œè¿˜æ˜¯ä¸åŒ…å«åŸæ•°æ®çš„

ä¿®æ”¹æ–‡ä»¶ï¼š `app/src/static/js/app.js` 
ä¿®æ”¹ç¬¬ 56 è¡Œ ï¼ŒæŠŠ `No items yet! Add one above!` ä¿®æ”¹æˆä½ çš„å­—ç¬¦ä¸²ã€‚

ç„¶åé‡æ–° build

```
docker build -t getting-started .
```

> ps æˆ‘åœ¨è¿™é‡Œå¤±è´¥äº†å¥½å¤šæ¬¡ï¼Œæˆ‘æŠŠåŸæ¥çš„ image åˆ é™¤ä¹‹åæ‰build æˆåŠŸ

é‡æ–°å¯åŠ¨ä¸€ä¸ªå®¹å™¨

```
docker run -dp 3000:3000 getting-started
```

## åœæ­¢å’Œåˆ é™¤å®¹å™¨

- `docker ps`å‘½ä»¤è·å–å®¹å™¨çš„ID
- `docker stop <the-container-id> `å‘½ä»¤åœæ­¢å®¹å™¨
- `docker rm <the-container-id>` åˆ é™¤å®¹å™¨

## åˆ†äº« image

ç»è¿‡åˆšæ‰çš„æ“ä½œï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸçš„åˆ¶ä½œäº†ä¸€ä¸ªè‡ªå·±çš„ image ï¼Œ ç°åœ¨æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆæŠŠå®ƒåˆ†äº«åˆ° docker hubã€‚

é¦–å…ˆå¾—ç™»é™†ä¸€ä¸‹ https://hub.docker.com 

```
docker login -u <your-user-name>
```

æŸ¥çœ‹ä¸€ä¸‹æœ¬åœ°ç°æœ‰çš„ image

```
docker image ls
```

ç»™ getting-started å¢åŠ  `tag` æ–¹ä¾¿æ¨é€

```
docker tag getting-started <your-user-name>/getting-started
```

æ¨é€ image

```
docker push <your-user-name>/getting-started
```

## æœ€ä½³å®è·µ

å…³äºå¦‚ä½•è®© docker æ–‡ä»¶å°½é‡æ›´å°ã€æ€ä¹ˆè®©æ•°æ®æ°¸ä¹…ä¿å­˜ç­‰å†…å®¹ï¼Œå‚è€ƒï¼š https://docs.docker.com/develop/dev-best-practices/